name: ğŸ“˜ Generar y publicar documentaciÃ³n

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build-docs:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Clona el repositorio
      - name: ğŸ”„ Checkout del repositorio
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Instala .NET SDK
      - name: ğŸ§© Configurar .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 7.0.x

      # 3ï¸âƒ£ Restaura dependencias
      - name: ğŸ“¦ Restaurar dependencias
        run: dotnet restore ./SingletonApp/SingletonApp.sln

      # 4ï¸âƒ£ Compila el proyecto
      - name: ğŸ› ï¸ Compilar soluciÃ³n
        run: dotnet build ./SingletonApp/SingletonApp.sln --configuration Release --no-restore

      # 5ï¸âƒ£ Generar documentaciÃ³n XML y Markdown con DocFX
      - name: ğŸ“„ Instalar DocFX
        run: |
          dotnet tool install -g docfx
          echo "$HOME/.dotnet/tools" >> $GITHUB_PATH

      - name: ğŸ§± Generar documentaciÃ³n con DocFX
        run: |
          docfx init -q
          docfx metadata
          docfx build

      # 6ï¸âƒ£ Generar diagrama de clases con PlantUML (usando Graphviz)
      - name: ğŸŒ Instalar Graphviz y PlantUML
        run: |
          sudo apt-get update
          sudo apt-get install -y graphviz
          sudo apt-get install -y plantuml

      - name: ğŸ–¼ï¸ Generar diagrama de clases
        run: |
          mkdir -p docs/diagramas
          find . -name "*.cs" > sourceFiles.txt
          plantuml -tpng sourceFiles.txt -o docs/diagramas/

      # 7ï¸âƒ£ Publicar en GitHub Pages
      - name: ğŸš€ Publicar en GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./_site  # Carpeta generada por DocFX

